# Requirements Document: Monorepo Restructure

## Introduction

This document specifies the requirements for restructuring the MueJam Library monorepo from its current organic growth state into a clean, professional, and maintainable structure. The repository contains a Django 5.0.1 backend with PostgreSQL/Prisma and a React 18/TypeScript/Vite frontend. The restructuring will organize code, documentation, tests, infrastructure, and tooling into clear, logical directories while preserving all production functionality.

## Glossary

- **Monorepo**: A single repository containing multiple related projects (backend, frontend, packages)
- **AI_Artifact**: Documentation files generated by AI assistants during development (TASK_*.md, *_SUMMARY.md, etc.)
- **Django_App**: A modular component within the Django backend (e.g., apps/backend/apps/core/)
- **Infrastructure_Code**: Code related to deployment, monitoring, caching, and system operations
- **Feature_Code**: Application-level business logic and user-facing functionality
- **Colocated_Tests**: Test files placed within the same directory as the code they test
- **Centralized_Tests**: Test files organized in a separate tests/ directory
- **Import_Path**: Python or TypeScript module import statement that references code location
- **Production_Code**: Code that runs in the deployed application (excludes tests, docs, scripts)
- **Temporary_Artifact**: Generated files from tools (cache, logs, compiled bytecode)
- **Seed_Script**: Utility script that populates database with initial or test data
- **Verification_Script**: Utility script that checks system configuration or state

## Requirements

### Requirement 1: Directory Structure Organization

**User Story:** As a developer, I want a clear top-level directory structure, so that I can quickly locate code, documentation, tests, and infrastructure.

#### Acceptance Criteria

1. THE System SHALL organize the repository into these top-level directories: apps/, packages/, docs/, tests/, scripts/, infra/, tools/
2. THE System SHALL place all deployable applications in apps/ (backend, frontend)
3. THE System SHALL place all shared libraries and reusable code in packages/
4. THE System SHALL place all documentation in docs/
5. THE System SHALL place all test suites in tests/
6. THE System SHALL place all automation and utility scripts in scripts/
7. THE System SHALL place all infrastructure-as-code in infra/
8. THE System SHALL place all development tools in tools/

### Requirement 2: AI Artifact Cleanup

**User Story:** As a developer, I want AI-generated documentation artifacts removed from the codebase, so that the repository contains only relevant, maintained documentation.

#### Acceptance Criteria

1. WHEN the System identifies files matching TASK_*.md pattern, THE System SHALL move them to docs/archive/ai-artifacts/
2. WHEN the System identifies files matching *_SUMMARY.md pattern, THE System SHALL move them to docs/archive/ai-artifacts/
3. WHEN the System identifies files matching PRODUCTION_*.md pattern at root or backend level, THE System SHALL move them to docs/archive/ai-artifacts/
4. WHEN the System identifies test_*.py files at root level, THE System SHALL move them to docs/archive/ai-artifacts/
5. WHEN the System identifies check_db.py or verify_*.py at root or backend root level, THE System SHALL move them to scripts/verification/
6. THE System SHALL create a docs/archive/README.md explaining the archive purpose
7. THE System SHALL preserve all AI_Artifact files (not delete) for historical reference

### Requirement 3: Documentation Consolidation

**User Story:** As a new contributor, I want all documentation in one place with clear hierarchy, so that I can understand the system without hunting through multiple directories.

#### Acceptance Criteria

1. THE System SHALL consolidate all README_*.md files from Django_App directories into docs/features/
2. THE System SHALL organize feature documentation by domain (authentication, moderation, gdpr, etc.)
3. THE System SHALL move apps/backend/docs/ contents to docs/backend/
4. THE System SHALL create docs/architecture/ for system design documentation
5. THE System SHALL create docs/deployment/ for deployment and operations documentation
6. THE System SHALL create docs/development/ for developer setup and workflow documentation
7. THE System SHALL maintain a single authoritative README.md at repository root
8. WHEN multiple README files exist for the same feature, THE System SHALL merge them into a single comprehensive document

### Requirement 4: Test Organization

**User Story:** As a developer, I want a consistent test organization strategy, so that I can easily write and run tests.

#### Acceptance Criteria

1. THE System SHALL keep Django_App tests colocated within apps/backend/apps/*/tests/
2. THE System SHALL move integration tests to tests/backend/integration/
3. THE System SHALL move end-to-end tests to tests/backend/e2e/
4. THE System SHALL move infrastructure tests from apps/backend/infrastructure/tests/ to tests/backend/infrastructure/
5. THE System SHALL move frontend tests to tests/frontend/
6. THE System SHALL remove inline test_*.py files from apps/backend/apps/moderation/ and move to appropriate test directories
7. THE System SHALL create tests/README.md documenting the test organization strategy
8. THE System SHALL preserve pytest.ini configuration and update paths if needed

### Requirement 5: Infrastructure Code Separation

**User Story:** As a DevOps engineer, I want infrastructure code clearly separated from application code, so that I can manage deployments and operations independently.

#### Acceptance Criteria

1. THE System SHALL move apps/backend/infrastructure/terraform/ to infra/terraform/
2. THE System SHALL move apps/backend/infrastructure/iam_policies/ to infra/iam-policies/
3. THE System SHALL identify Feature_Code in apps/backend/infrastructure/ (account_suspension.py, shadowban.py, audit_log_service.py, audit_log_views.py, suspicious_activity_detector.py)
4. WHEN Feature_Code is identified in infrastructure/, THE System SHALL move it to appropriate Django_App or create new Django_App
5. THE System SHALL keep true Infrastructure_Code in apps/backend/infrastructure/ (caching, monitoring, database config, logging, metrics, health checks)
6. THE System SHALL move deployment scripts from apps/backend/scripts/ to scripts/deployment/
7. THE System SHALL document the infrastructure code organization in docs/architecture/infrastructure.md

### Requirement 6: Script Organization

**User Story:** As a developer, I want utility scripts organized by purpose, so that I can find and use automation tools easily.

#### Acceptance Criteria

1. THE System SHALL move seed_data.py and seed_legal_documents.py to scripts/database/
2. THE System SHALL move verify_*.py scripts to scripts/verification/
3. THE System SHALL move deployment scripts to scripts/deployment/
4. THE System SHALL create scripts/README.md documenting available scripts and their usage
5. THE System SHALL update script shebang lines and import paths as needed
6. THE System SHALL ensure all scripts remain executable after moving

### Requirement 7: Temporary File Cleanup

**User Story:** As a developer, I want temporary and generated files excluded from version control, so that the repository stays clean.

#### Acceptance Criteria

1. THE System SHALL ensure .hypothesis/ directories are in .gitignore
2. THE System SHALL ensure .pytest_cache/ directories are in .gitignore
3. THE System SHALL ensure __pycache__/ directories are in .gitignore
4. THE System SHALL ensure logs/ directories are in .gitignore
5. THE System SHALL ensure node_modules/ is in .gitignore
6. THE System SHALL verify .gitignore covers all common temporary file patterns
7. THE System SHALL document the .gitignore strategy in CONTRIBUTING.md

### Requirement 8: Naming Convention Consistency

**User Story:** As a developer, I want consistent directory naming conventions, so that the codebase feels professional and predictable.

#### Acceptance Criteria

1. THE System SHALL use lowercase with hyphens (kebab-case) for all new top-level directories
2. THE System SHALL rename infra/terraform/ subdirectories to use kebab-case if needed
3. THE System SHALL preserve Django_App naming conventions (snake_case as per Django standards)
4. THE System SHALL preserve Python module naming conventions (snake_case)
5. THE System SHALL document naming conventions in docs/development/conventions.md
6. WHEN renaming directories, THE System SHALL update all references in code and configuration

### Requirement 9: Configuration File Updates

**User Story:** As a developer, I want all configuration files updated to reflect the new structure, so that the application builds and runs correctly.

#### Acceptance Criteria

1. WHEN Python files are moved, THE System SHALL update all import statements
2. WHEN directories are renamed, THE System SHALL update Django settings.py INSTALLED_APPS
3. WHEN test files are moved, THE System SHALL update pytest.ini test paths
4. WHEN scripts are moved, THE System SHALL update docker-compose.yml volume mounts and commands
5. THE System SHALL update Dockerfile COPY and WORKDIR statements
6. THE System SHALL update package.json scripts if paths change
7. THE System SHALL verify all configuration changes with syntax validation
8. THE System SHALL document configuration changes in docs/deployment/migration-guide.md

### Requirement 10: Build and Runtime Verification

**User Story:** As a developer, I want the restructured repository to build and run successfully, so that I can continue development without disruption.

#### Acceptance Criteria

1. WHEN restructuring is complete, THE System SHALL verify Django can start (python manage.py check)
2. WHEN restructuring is complete, THE System SHALL verify frontend builds (npm run build)
3. WHEN restructuring is complete, THE System SHALL verify Docker Compose builds all services
4. WHEN restructuring is complete, THE System SHALL verify pytest can discover and run tests
5. WHEN restructuring is complete, THE System SHALL verify all import statements resolve correctly
6. THE System SHALL create a verification script that checks all critical paths
7. THE System SHALL document the verification process in docs/deployment/verification.md

### Requirement 11: Migration Documentation

**User Story:** As a team member, I want clear documentation of what changed and why, so that I can understand the new structure and update my workflows.

#### Acceptance Criteria

1. THE System SHALL create docs/deployment/migration-guide.md documenting all structural changes
2. THE System SHALL document file movement mapping (old path â†’ new path)
3. THE System SHALL document import path changes
4. THE System SHALL document configuration file changes
5. THE System SHALL document new directory purposes and conventions
6. THE System SHALL provide examples of common tasks in the new structure
7. THE System SHALL include a troubleshooting section for common migration issues
8. THE System SHALL update the root README.md to reflect the new structure

### Requirement 12: Preservation of Production Code

**User Story:** As a product owner, I want all production functionality preserved exactly, so that the restructuring does not introduce bugs or break features.

#### Acceptance Criteria

1. THE System SHALL NOT modify any Production_Code logic during restructuring
2. THE System SHALL NOT delete any Production_Code files
3. THE System SHALL preserve all Django_App internal structure
4. THE System SHALL preserve all database models and migrations
5. THE System SHALL preserve all API endpoints and URL routing
6. THE System SHALL preserve all frontend components and pages
7. WHEN uncertain about deleting a file, THE System SHALL mark it as "candidate for removal" in docs/deployment/migration-guide.md
8. THE System SHALL create a checklist of preserved functionality for manual verification

### Requirement 13: Incremental Migration Support

**User Story:** As a developer, I want the ability to migrate incrementally, so that I can test changes in stages rather than all at once.

#### Acceptance Criteria

1. THE System SHALL organize migration tasks into logical phases
2. THE System SHALL document dependencies between migration phases
3. THE System SHALL provide rollback instructions for each phase
4. THE System SHALL create git branch strategy recommendations
5. THE System SHALL identify which changes can be done independently
6. THE System SHALL identify which changes must be done together
7. THE System SHALL document testing checkpoints after each phase

### Requirement 14: Developer Experience Improvements

**User Story:** As a developer, I want improved tooling and documentation, so that I can work more efficiently in the restructured repository.

#### Acceptance Criteria

1. THE System SHALL create a comprehensive CONTRIBUTING.md with setup instructions
2. THE System SHALL document the monorepo structure in docs/architecture/monorepo-structure.md
3. THE System SHALL create scripts/setup.sh for automated development environment setup
4. THE System SHALL document common development workflows in docs/development/workflows.md
5. THE System SHALL create a troubleshooting guide in docs/development/troubleshooting.md
6. THE System SHALL document testing strategies in docs/development/testing.md
7. THE System SHALL provide IDE configuration recommendations in docs/development/ide-setup.md

### Requirement 15: Infrastructure as Code Organization

**User Story:** As a DevOps engineer, I want infrastructure code organized by environment and purpose, so that I can manage deployments systematically.

#### Acceptance Criteria

1. THE System SHALL organize infra/terraform/ by environment (dev, staging, production)
2. THE System SHALL create infra/monitoring/ for monitoring configurations
3. THE System SHALL move monitoring-related code from apps/backend/infrastructure/ to infra/monitoring/
4. THE System SHALL create infra/README.md documenting infrastructure organization
5. THE System SHALL document infrastructure deployment procedures in docs/deployment/infrastructure.md
6. THE System SHALL preserve all IAM policies and document their purpose
7. THE System SHALL create infra/scripts/ for infrastructure automation

### Requirement 16: Package Organization

**User Story:** As a developer, I want shared code organized as reusable packages, so that I can avoid duplication and maintain consistency.

#### Acceptance Criteria

1. THE System SHALL identify candidates for shared packages (utilities used by both frontend and backend)
2. THE System SHALL create packages/README.md documenting package organization strategy
3. THE System SHALL document how to create new packages in docs/development/packages.md
4. THE System SHALL preserve existing packages/ structure
5. WHEN shared code is identified, THE System SHALL document it as a candidate for extraction
6. THE System SHALL document package versioning strategy
7. THE System SHALL document package dependency management

### Requirement 17: Documentation Quality Standards

**User Story:** As a contributor, I want documentation that follows consistent quality standards, so that I can trust and understand it easily.

#### Acceptance Criteria

1. THE System SHALL ensure all documentation uses Markdown format
2. THE System SHALL ensure all documentation has clear headings and structure
3. THE System SHALL ensure all code examples in documentation are syntax-highlighted
4. THE System SHALL ensure all documentation includes a table of contents for documents over 200 lines
5. THE System SHALL ensure all documentation includes last-updated dates
6. THE System SHALL create a documentation style guide in docs/development/documentation-style.md
7. THE System SHALL validate all internal documentation links

### Requirement 18: Continuous Integration Preparation

**User Story:** As a DevOps engineer, I want the repository structure to support CI/CD pipelines, so that I can automate testing and deployment.

#### Acceptance Criteria

1. THE System SHALL create .github/workflows/ directory structure
2. THE System SHALL document CI/CD pipeline requirements in docs/deployment/ci-cd.md
3. THE System SHALL identify test commands for CI pipeline
4. THE System SHALL identify build commands for CI pipeline
5. THE System SHALL identify deployment commands for CI pipeline
6. THE System SHALL document environment variable requirements for CI
7. THE System SHALL create example GitHub Actions workflows in docs/deployment/ci-cd.md

### Requirement 19: Dependency Management

**User Story:** As a developer, I want clear dependency management, so that I can understand and update project dependencies safely.

#### Acceptance Criteria

1. THE System SHALL preserve requirements.txt for backend dependencies
2. THE System SHALL preserve package.json for frontend dependencies
3. THE System SHALL document dependency update procedures in docs/development/dependencies.md
4. THE System SHALL identify and document all external service dependencies
5. THE System SHALL document version pinning strategy
6. THE System SHALL create a dependency audit checklist
7. THE System SHALL document how to add new dependencies

### Requirement 20: Archive Strategy

**User Story:** As a maintainer, I want a clear strategy for archiving old code and documentation, so that the repository stays clean while preserving history.

#### Acceptance Criteria

1. THE System SHALL create docs/archive/ for historical documentation
2. THE System SHALL create docs/archive/ai-artifacts/ for AI-generated files
3. THE System SHALL create docs/archive/README.md explaining archive purpose and retention policy
4. THE System SHALL document what types of files belong in archive
5. THE System SHALL document when to archive vs delete files
6. THE System SHALL preserve git history for all archived files
7. THE System SHALL create an archive index in docs/archive/INDEX.md listing all archived content
